# README

This is a readme for the MATLAB code provided as supplementary files to the article:

Girani et. al., (Submitted). Spin transition in Fe2+ at ultra-high pressure sets Earth’s redox state.

The code in this repository allows the calculation of fo2 along an adiabatic thermal profile.


## Installation

The repository contains the code and the input files required for the execution, which must be placed in the same directory. The code has been tested for MATLAB versions later than R2023b.
For the execution the following toolboxes must be also installed in MATLAB:
 
* optimization toolboox
* curve fitting toolbox


## Usage

The main script is *Fo2_spintransition_calc.m*. In this script it is possible to:
* change the Fe3+/Fetot ratio
* the pressure range for the calculations of the fo2
* the number of steps (i.e., the resolution) of the calculation of fo2 along a thermal profile

The fo2 can then be calculated along a geotherm or at a specific temperature.
At the end of the execution, the script saves a table of results to the output file *fo2_calc.xlsx*. 
(Note: each execution overwrites the existing output file). 

The main script requires several input files:
* *Input_Parameters_All.xlsx* contains the input parameters for the calculation (atomic mass, Margules parameters)
* *fitting_nFeLS.mat* contains the fitting function of the low-spin fraction of each iron species with pressure. Generated by the script *./fitting_functions/fit_spin_transition.m*
* *geotherm.mat* contains the function of the geotherm with P[GPa] and T[K]. Generated by the script */fitting_functions/fit_geotherms_spline.m*
* *interpolation_deltaV_HS_LS.mat* contains the interpolation function of the volume difference (deltaV) of both Feo1.5 and FeO from HS state to LS state, as a function of T[K]. Generated by the script */fitting_functions/interpolation_deltaV_HS_LS.m*

The input files can be replaced by user's custom *.mat* files having the same structure.



## Credits
This library makes use of scripts and files released from Hirschmann et. al. (2021, Iron-wüstite revisited: A revised calibration accounting for variable stoichiometry and the effects of pressure, https://doi.org/10.1016/j.gca.2021.08.039):
* *IWCalcHirschmmann2.m* which has been modified to create the script "calculate_IW.m" in this code 
* *VinetVolumeFunc2.m*
* *StableIronPhase.m*
* *SGTEIron.xlsx*

The code and files of Hirschmann et. al. (2021) are released with a open license and can be downloaded from https://www.sciencedirect.com/science/article/abs/pii/S0016703721005160



## License

MIT License

Copyright (c) [2024] [Girani A., Petitgirard S., Yaroslavtsev S.,
Aprilis G., Badro J., Bezos A., Sossi P.A.]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this code and associated documentation files, to deal in the code without restriction, 
including without limitation the rights to use, copy, modify, merge, publish, 
and/or  distribute, copies of the code, and to permit persons to whom 
the code is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the code.

THE CODE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL 
THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, 
OUT OF OR IN CONNECTION WITH THE CODE OR THE USE OR OTHER DEALINGS IN THE CODE.
